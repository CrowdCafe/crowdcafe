{% extends 'kitchen/kitchen.html'%}
{%load static%}


{% block kitchen%}
<style>
.btn-toolbar{
	z-index:1;
	opacity:0.95;
}
.create-preselection{
	margin-top:-10px;
}
</style>
<!-- content-8  -->
<section class="">
	<div>
		<div class="container center">
			<h1 class='center'>Create a job in 6 easy steps:</h1>
			<form method='POST' action='{% url 'kitchen-job-save' %}' enctype="multipart/form-data">
				{% csrf_token %}

				<div class="row">
					<div class="col-sm-6 form-group">
						<p class='lead'>1. Title</p>
						<span>Be specific. 1 - 5 words only. </span>
						<input type='text' name='job_title' class="form-control" style="width:100%;padding:10px 0px;" placeholder='Sentiment Analysis'>
					</div>
					<div class="col-sm-6">
						<p class='lead'>2. Instructions</p>
						<span>Clear instructions. Not more than 140 characters.</span>
						<textarea type='text' name='job_description' class="form-control" style="width:100%;padding:10px 0px;"></textarea>
					</div>
				</div>
				<div class='row'>
					<hr/>
				</div>
				<div class='row'>
					<div class="col-sm-3">
						<p class='lead'>3. Category</p>
						{% for category in task_categories%}
						<label class="radio">
							<input type="radio" name="job_category" class="form-control" id="optionsRadios1" value="{{category.id}}" data-toggle="radio" checked="checked">
							<b>{{category.title}}</b> ({{category.cost}}&euro; / {{category.time}})
						</label>
						{% endfor %}
					</div>
					<div class="col-sm-6 preselection-block">
						<p class='lead'>4. Preselection (optional)</p>
						<div >
							<select class='preselection_new_rule_type'>
								<option value="WO">worked on a job</option>
								<option value="NW">did not work on a job</option>
							</select>
							<select class='preselection_new_related_task'>
								<option value="0">select a job</option>
								{% for job in jobs%}
								<option value="{{job.id}}">#{{job.id}} {{job.title}}</option>
								{% endfor%}
							</select>
							<input type="button"  class="btn btn-primary create-preselection" value="+">
						</div>
					</div>
					<div class="col-sm-3">
						<p class='lead'>5. User Interface</p>
						
						<input  class='block center form-control'  type='text' style='width:100%;padding:10px 0px;' name='userinterface_template' placeholder= 'URL leading to raw HTML file' >
						<select name="template-list" style="width:60%;">
							<option value="" >Select a template</option>
							{% for html_template in html_templates %}
							<option value="{{html_template.url}}" >{{html_template.name}}</option>
							{% endfor %}
						</select><br/>
						<span>URL leading to raw HTML file.</span><br/>
						<span>check existing <a href ="https://github.com/CrowdCafe/crowdcafe-ui-templates" target="_blank" >templates</a> on GitHub.</span>
					</div>
				</div>
				<div class='row'>
					<hr/>
				</div>
				<div class="row">
					<div class="col-sm-12">
						<p class='lead'>6. Data <div class="btn-toolbar center">
							<div class="btn-group dataset_options">
								<a class="btn btn-primary" block-name = "api" href="#"><i class="fa fa-circle-o"> none (API)</i></a>
								<a class="btn btn-primary" block-name = "survey" href="#"><i class="fa fa-circle-o"> none (Survey)</i></a>
								<a class="btn btn-primary" block-name = "dataset" href="#"><i class="fa fa-file-o"> dataset (.CSV)</i></a>
								<a class="btn btn-primary" block-name = "feed" href="#"><i class="fa fa-globe"> dataset (Social Network)</i></a>
							</div>
						</div></p>

					</div>
				</div>
				<input type = "hidden" id="dataset_option_selected" name="dataset_option_selected" value = "">
				<div class="row dataset_options">
					<div class="col-sm-12 block-api">
						<p>No data (dataitems will be uploaded via API)</p>
					</div>
					<div class="col-sm-12 block-survey">
						<p>Survey. Only one dataitem will be created (questions are defined in a UI template). </p>
					</div>
					<div class="span12 block-dataset">
						<label class="uploadbutton">
							<div class="btn"  style="width:100%;padding:10px 0px;">Upload</div>
							<p><a href = '{% static "files/dataset_template.csv" %}' target='_blank'>dataset template</a></p>
							<input type="file" name='dataset' onchange="this.previousSibling.previousSibling.innerHTML = this.value"/>
						</label>
					</div>
					<div class="col-sm-12 block-feed">
						<input  class='block form-control'   type='text' style='float:left;margin-top:2px;width:15%;text-align: center;' name='feed_amount' value='20' >
						<input type='text form-control' class='block' name='feed_handler' style='float: left;width: 25%;margin-top: 2px;' placeholder='trento'>
						<select name="feed-type" style="width:60%;">
							<!--option value="0" selected>Twitter</option>
							<option value="1" >Facebook</option-->
								<option value="2" >Instagram</option>
							</select>
						</div>
					</div>
					<div class='row'>
						<hr/>
					</div>
					<div class="row">
						<div class="col-sm-1">
							<input  class='block form-control'  type='text' style='width: 40px;text-align: center;padding-right: 15px;' name='dataitems_per_task' value='5' ><span>Data dataitems / task</span>
						</div>
						<div class="col-sm-1">
							<input type='text' class='form-control' style='width: 40px;text-align: center;padding-right: 15px;'  name='min_answers_per_item' value='1' ><span>Min answers / dataitem</span>
						</div>
						<div class="col-sm-1">
							<input type='text' class='form-control' style='width: 40px;text-align: center;padding-right: 15px;'  name='min_gold_per_task' value='0' ><span>Min gold / task</span>
						</div>
						<div class="col-sm-1">
							<input type='text' class='form-control' style='width: 40px;text-align: center;padding-right: 15px;'  name='max_gold_per_task' value='3' ><span>Max gold / task</span>
						</div>
						<div class="col-sm-1">
							<input type='text' class='form-control' style='width: 40px;text-align: center;padding-right: 15px;'  name='max_dataitems_per_worker' value='100' ><span>Max dataitems / worker, %</span>
						</div>
						<div class="col-sm-2">
							<input type='text'  class='form-control' style='width: 40px;text-align: center;padding-right: 15px;'  name='min_score' value='0' ><br/><span>Min score (default = 0)<br/><small>when user goes below - he can not work on the job any more and is not paid for the last task</small></span>
						</div>
						<div class="col-sm-3">
							<select name="device_type" style="width:60%;">
								<option value="0" >Any device</option>
								<option value="1" >Mobile Only</option>
								<option value="2" >Desktop Only</option>
							</select><br/>
							<span>To be executed on</span>
						</div>
						<div class="col-sm-2">
							<input type='text'  class='form-control' style='width: 150px;text-align: center;padding-right: 15px;' placeholder = "http://yourApp.com/callback/"  name='webhook_url' >
							<span>Webhook URL</span>
						</div>
					</div>

					<div class='row'>
						<hr/>
					</div>
					<div class='row'>
						<div class="col-sm-12">
							<p class='center'>
								<a class="btn btn-googleplus" href="mailto:team@crowdcafe.io" target="_blank"><i class="fa fa-envelope"></i> Ask us to design a job for you (free)!</a>
								<input type = 'submit' class='btn btn-googleplus-inversed' value='Save job'>
							</p>
						</div>
					</div>
				</form>
			</div>
		</div>
	</section>
	{% endblock%}

	{% block scripts%}
	<script>
	$(document).ready(function(){
		$('form').submit(function(){
			var issue = false;

			if ($('.dataset_options .active').length == 0){
				issue = 'define your dataset';
			}
			if (!$('[name=userinterface_template]').val() || $('[name=userinterface_template]').val()==''){
				issue = 'please select the user interface template';
			}
			if (!$('[name=job_description]').val() || $('[name=job_description]').val() == ''){
				issue = 'please define a description for your job';
			}
			if (!$('[name=job_title]').val() || $('[name=job_title]').val() ==''){
				issue = 'please define a title for your job';
			}
			
			if (issue){
				alert(issue);
				return false;
			}

		});
		$('.dataset_options > .btn').click(function(){
			var block_name = $(this).attr('block-name');

			$('.dataset_options > *').removeClass('active');
			$(this).addClass('active');
			$('#dataset_option_selected').val(block_name);
			$('.block-'+block_name).addClass('active');

			return false;
		});

		$('[name=template-list]').change(function(){
			$('[name=userinterface_template]').val($(this).val());
		});
		$('.create-preselection').click(function(){
			if ($('.preselection_new_related_job').val()!=0){
				var preselection = "<p class='preselection'>"+
				"<input type='hidden' name='preselection_rule' value = '"+$('.preselection_new_rule_type').val()+"'>"+
				"<input type='hidden' name='preselection_job' value = '"+$('.preselection_new_related_job').val()+"'>"+
				"preselection ["+$('.preselection_new_rule_type').val() + "] for job ["+ $('.preselection_new_related_job').val()+"]"+
				"<input type = 'button' class='btn' value = 'remove' onclick = '$(this).parent().remove();'>"+
				"</p>";
				$('.preselection-block').append(preselection);
			}
		});
	});
</script>
{% endblock%}